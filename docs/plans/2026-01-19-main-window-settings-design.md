# 主窗口与设置页扩展设计

## 目标

在 MVP 之上实现完整主窗口功能与设置页：

- 主窗口包含历史列表、对比/编辑、设置页
- 历史列表支持行内编辑与复制
- 设置页覆盖触发方式（含触摸板手势）、转写、Refine、输出、历史、通用
- 支持触摸板手势（长按/热区）并在启用时引导授权

## 主窗口结构

采用单窗口 + 侧边栏布局，左侧导航：

- **历史**
- **对比与编辑**
- **设置**

默认进入“历史”页。

## 历史列表与行内编辑

### 列表字段

每条记录显示：

- 时间戳
- 原始文本
- Refine 文本
- 使用的模式组合
- 目标应用

### 行内编辑流程

- 列表行内提供“选择版本”（原始/Refine）
- 选择后进入该行编辑态（多行文本框）
- 仅提供“复制”按钮，写入剪贴板
- 复制后退出编辑态
- 保存编辑结果，并标记该条记录为“已编辑”

### 历史上限

- 默认保留 100 条
- 超限时按时间淘汰最旧记录

## 设置页

设置页分组：

- **触发方式**：快捷键配置；触摸板手势开关与类型（长按/热区）；热区位置；触发时长阈值
- **转写**：默认语言；Whisper 服务端口（仅高级设置）
- **Refine**：默认组合（多选）；内置 prompt 可编辑；是否自动 Refine
- **输出**：复制后是否自动清空剪贴板；提示音效开关
- **历史**：保留条数；是否记录目标应用
- **通用**：开机启动；菜单栏图标样式

## 触摸板手势

- 启用时启动手势监听
- 若权限不足，提示并引导到系统设置
- 触发后进入现有录音流程
- **范围限制**：本次实现仅覆盖“热区停留 2s”，Force Touch 按压作为后续扩展

## 数据模型

- `SettingsStore` 统一读写 UserDefaults
- `SettingsViewModel` 绑定 UI
- 历史记录内存存储，字段包含：时间戳、原始文本、Refine 文本、模式组合、目标应用、是否已编辑、最后复制文本

## 错误处理

- 手势权限缺失：设置页提示并可跳转系统设置
- Whisper 不可用：提示错误，不写入空文本记录
- Refine 不可用：自动降级为仅转写，记录 mode=off
- 粘贴失败：提示“你可以在目标位置粘贴”，面板保持可见直到下一次录音或用户手动隐藏

## 测试建议

- UI：侧边栏导航、历史列表行内编辑、设置页各分组展示
- 逻辑：历史上限淘汰、编辑保存、Refine 组合持久化
- 手势：启用时触发提示、权限缺失流程
- 录音链路：正常转写与降级路径
